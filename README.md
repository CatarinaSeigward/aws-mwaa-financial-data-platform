# AWS MWAA ä¼ä¸šçº§é‡‘èæ•°æ®é›†æˆä¸è´¨é‡æ²»ç†å¹³å°

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

æœ¬é¡¹ç›®æ„å»ºäº†ä¸€ä¸ªé«˜å¯ç”¨ã€å¯æ‰©å±•çš„äº‘åŸç”Ÿæ•°æ®ç®¡é“ï¼Œç”¨äºé›†æˆå¤–éƒ¨é‡‘èè¡Œæƒ… APIï¼ˆAlpha Vantageï¼‰ã€‚æ ¸å¿ƒç›®æ ‡æ˜¯è§£å†³é‡‘èæ•°æ®å¤„ç†ä¸­çš„**æ•°æ®è´¨é‡ä¸å¯è¿½æº¯æ€§**é—®é¢˜ï¼ŒåŒæ—¶ä¼˜åŒ–**è¿ç»´æˆæœ¬**ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AWS MWAA (Airflow)                             â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                           â”‚   DAG Orchestrator  â”‚                           â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                             â”‚                             â”‚
         â–¼                             â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Data Ingest   â”‚         â”‚  Data Validate  â”‚         â”‚ Data Transform  â”‚
â”‚  (Alpha Vantage)â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚(Great Expect.)  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   (AWS Glue)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚                           â”‚
         â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  S3 Raw Layer   â”‚         â”‚ S3 Validation   â”‚         â”‚ S3 Curated Layerâ”‚
â”‚     (JSON)      â”‚         â”‚    Results      â”‚         â”‚   (Parquet)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
                                                                 â–¼
                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                      â”‚    Redshift     â”‚
                                                      â”‚   Serverless    â”‚
                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                             â”‚                             â”‚
         â–¼                             â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CloudWatch    â”‚         â”‚     Lambda      â”‚         â”‚      Slack      â”‚
â”‚    Metrics      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Notifier      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Alerts        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
aws-mwaa-financial-data-platform/
â”œâ”€â”€ README.md                           # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ requirements.txt                    # Pythonä¾èµ–
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ settings.py                    # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ expectations/                  # Great Expectationsé…ç½®
â”‚       â””â”€â”€ stock_data_suite.json
â”œâ”€â”€ dags/
â”‚   â””â”€â”€ financial_data_pipeline.py     # Airflow DAG
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ ingestion/
â”‚   â”‚   â””â”€â”€ alpha_vantage_client.py    # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ validation/
â”‚   â”‚   â””â”€â”€ data_validator.py          # Great ExpectationséªŒè¯
â”‚   â”œâ”€â”€ transformation/
â”‚   â”‚   â””â”€â”€ glue_transform.py          # PySparkè½¬æ¢è„šæœ¬
â”‚   â””â”€â”€ loading/
â”‚       â””â”€â”€ redshift_loader.py         # RedshiftåŠ è½½
â”œâ”€â”€ lambda/
â”‚   â””â”€â”€ slack_notifier/
â”‚       â”œâ”€â”€ handler.py                 # Lambdaå¤„ç†å‡½æ•°
â”‚       â””â”€â”€ requirements.txt
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ cloudformation/                # CloudFormationæ¨¡æ¿
â”‚   â””â”€â”€ terraform/                     # Terraformé…ç½®
â”œâ”€â”€ tests/                             # å•å…ƒæµ‹è¯•
â””â”€â”€ scripts/                           # éƒ¨ç½²è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- AWS CLI å·²é…ç½®
- Python 3.9+
- Terraform 1.5+ (å¯é€‰)
- Alpha Vantage API Key

### 1. å…‹éš†å¹¶é…ç½®

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd aws-mwaa-financial-data-platform

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ä½ çš„é…ç½®
```

### 2. éƒ¨ç½²åŸºç¡€è®¾æ–½

```bash
# ä½¿ç”¨ CloudFormation
cd infrastructure/cloudformation
./deploy.sh

# æˆ–ä½¿ç”¨ Terraform
cd infrastructure/terraform
terraform init
terraform plan
terraform apply
```

### 3. ä¸Šä¼  DAG æ–‡ä»¶

```bash
# ä¸Šä¼ åˆ° MWAA S3 å­˜å‚¨æ¡¶
aws s3 sync dags/ s3://<mwaa-bucket>/dags/
aws s3 sync src/ s3://<mwaa-bucket>/dags/src/
```

## ğŸ” å®‰å…¨é…ç½®

### IAM æœ€å°æƒé™åŸåˆ™

| è§’è‰² | æƒé™ |
|------|------|
| Ingestion | `s3:PutObject`, `s3:GetBucketLocation`, `kms:Encrypt` |
| Glue/Validation | `s3:GetObject`, `s3:PutObject`, `s3:ListBucket`, `kms:Decrypt` |
| Redshift | S3è¯»æƒé™, `redshift:GetCredentials` |

### åŠ å¯†

- S3: SSE-KMS åŠ å¯†
- Redshift: ä¼ è¾“ä¸­åŠ å¯† + é™æ€åŠ å¯†
- Secrets Manager: å­˜å‚¨ API å¯†é’¥

## ğŸ’° æˆæœ¬ä¼˜åŒ–

1. **S3 Lifecycle**: Raw æ•°æ® 30 å¤©åè½¬å…¥ Glacier
2. **Redshift Serverless**: æŒ‰éœ€è®¡è´¹ï¼Œç©ºé—²è‡ªåŠ¨æš‚åœ
3. **Glue**: æŒ‰ DPU-hour è®¡è´¹ï¼Œä½¿ç”¨ Flex æ‰§è¡Œ

## ğŸ“Š æ•°æ®è´¨é‡é—¸é—¨

ä½¿ç”¨ Great Expectations å®ç°æ•°æ®è´¨é‡æ ¡éªŒï¼š

```python
# ç¤ºä¾‹æ ¡éªŒè§„åˆ™
expect_column_values_to_be_between("high_price", min_value=0)
expect_column_values_to_not_be_null("timestamp")
expect_table_row_count_to_be_between(min_value=1, max_value=10000)
```

## ğŸ“ˆ ç›‘æ§ä¸å‘Šè­¦

- **CloudWatch Dashboard**: å®æ—¶ç›‘æ§ DAG æ‰§è¡ŒçŠ¶æ€
- **CloudWatch Alarms**: ä»»åŠ¡å¤±è´¥è‡ªåŠ¨è§¦å‘
- **Slack é€šçŸ¥**: å®æ—¶æ¨é€å‘Šè­¦ä¿¡æ¯

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/ -v

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/ -v -m integration
```

## ğŸ“ è®¸å¯è¯

MIT License
